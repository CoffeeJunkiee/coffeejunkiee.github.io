---
title:  "Hack The Box / Jail"
date: 2020-01-26
tags: [Penetration Testing, Hacking, Hack The Box, Jeeves, OSCP, Offensive Security]
header: 
  image: "assets/images/jail/jail-header.png"
---
Jail is our fifth machine in the OSCP list provided by [NetSec Focus](https://www.netsecfocus.com/)! This machine was a great learning experience where buffer overflow, custom exploit development, and linux privilege escalation were crucial in order to obtain this machine. This machine show my weaknesses in buffer overflow, custom exploit development, and linux privilege escalation, so it was a great learning experience, and without [Booj's](https://reboare.github.io/htb/htb-jail.html) guide root this machine would've not been possible. This is the fifth blog before my third attempt to the OSCP exam, so let's get to it!

## Information Gathering

### Nmap Scan
So, we start with a nmap scan to check what ports are open and what services are running in this machine. 

```
nmap -sC -sV -p- -oN scan.nmap 10.10.10.34
```
<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/nmap.png" alt="nmap scan">

So, we see some HTTP, RCPBIND, NFS, and a "random" service running. Actually, good results will come from the "random" service and the HTTP, about NFS we'll get that later. 

### Visiting Port 80 HTTP
The first thing we see getting in this port is a jail cell, which is relatable with the name of the machine. 

<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/port80.png" alt="nmap scan">

Sounds like time to do some directory brute force!

### Directory Brute Force

Running [dirsearch](https://github.com/maurosoria/dirsearch) in port 80 gave us a good result.
```
python3 dirsearch.py -u http://10.10.10.34 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e php -t 50
```
<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/dir-search.png" alt="nmap scan">

Yay! We got a good result with ```http://10.10.10.34/jailuser/``` let's check what's in there. 

<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/jailuser.png" alt="nmap scan">

So, going to ```http://10.10.10.34/jailuser/dev``` there are three files that can give us useful information.

### Checking files from Jail

We start with ```jail.c``` and looking at the code it looks like buffer overflow!

<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/bof-proof.png" alt="nmap scan">

According the screenshot showed above, there are variables that are "overflowable" because they can handle certain amount of characters before they overwrite the memory. Also the "random" service that we talked in our Nmap scan seems to be related with this buffer overflow because in the code shares its connection with port 7411.

<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/jail7411.png" alt="nmap scan">

Besides this in this code we can see some credentials that are going to be useful for exploit development. 

<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/jail-userpass.png" alt="nmap scan">

Also, there is another file called ```compile.sh```, after giving it permissions it compiles the file and we can run it and start working with the debugger and some other things!

```
telnet localhost 7411
```
<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/compile-proof.png" alt="nmap scan">

### Start Experimenting with buffer overflow and other things.

Time to run [gdb](https://www.geeksforgeeks.org/gdb-command-in-linux-with-examples/)! 

<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/gdb.png" alt="nmap scan">

After starting our debugger it's time to crearte a pattern, you can use gdb or the packet from metasploit for this which is located at /usr/share/metasploit-framework/tools/exploit/
```
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 50
```
<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/pattern-create.png" alt="nmap scan">

Now that we have the pattern it's time to send it where we must overwrite the EIP which in this case is the password parameter.

<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/nc-bof.png" alt="nmap scan">

And we have found the memory address where EIP overwrites.

<img src="{{ site.url }}{{ site.baseurl }}/assets/images/jail/gdb-found.png" alt="nmap scan">



